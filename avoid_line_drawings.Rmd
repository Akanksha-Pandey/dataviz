```{r echo = FALSE, message = FALSE}
# run setup script
source("_common.R")

library(dplyr)
library(forcats)
library(readr)
library(ggridges) # for geom_density_line
```


# Avoid line drawings {#avoid-line-drawings}

Whenever possible, visualize your data with solid, colored shapes rather than with lines that outline those shapes. Solid shapes are more easily perceived, are less likely to create visual artifacts or optical illusions, and do more immediately convey amounts than do outlines. In my experience, visualizations using solid shapes are both clearer and more pleasant to look at than equivalent versions that use line drawings. Thus, I avoid line drawings as much as possible. However, I want to emphasize that this recommendation does not supersede the principle of proportional ink (Chapter \@ref(proportional-ink)).

Line drawings have a long history in the field of data visualization because throughout most of the 20th century, scientific visualizations were drawn by hand and had to be reproducible in black-and-white. This precluded the use of areas filled with solid colors, including solid gray-scale fills. Instead, filled areas were sometimes simulated by applying hatch, cross-hatch, or stipple patterns. Early plotting software imitated the hand-drawn simulations and similarly made extensive use of line drawings, dashed or dotted line patterns, and hatching. While modern visualization tools and modern reproduction and publishing platforms have none of these limitations, many plotting softwares still default to outlines and empty shapes rather than filled areas. To raise your awareness of this issue, here I'll show here several examples of the same figures drawn with both lines and filled shapes.

The most common and at the same time most inappropriate use of line drawings is seen in histograms and bar plots. The problem with bars drawn as outlines is that it is not immediately apparent which side of any given line is inside a bar and which side is outside. As a consequence, in particular when there are gaps between bars, we end up with a confusing visual pattern that detracts from the main message of the figure (Figure \@ref(fig:titanic-ages-lines)). Filling the bars with a light color, or with gray if color reproduction is not possible, avoids this problem (Figure \@ref(fig:titanic-ages-filled)).

(ref:titanic-ages-lines) Histogram of the ages of Titanic passengers, drawn with empty bars. The empty bars create a confusing visual pattern. In the center of the histogram, it is difficult to tell which parts are inside of bars and which parts are outside. 

```{r titanic-ages-lines, message=FALSE, warning=FALSE, fig.cap='(ref:titanic-ages-lines)'}
df <- read_csv("datasets/Titanic.csv")
titanic <- na.omit(data.frame(age = df$Age, sex = df$Sex, survived = df$Survived))
age_hist_3 <- data.frame(age = (1:25)*3-1.5, 
                         count = hist(titanic$age, breaks=(0:25)*3 + .01, plot = FALSE)$counts)

h3_bad <- ggplot(age_hist_3, aes(x = age, y = count)) + geom_col(width = 2., fill = "transparent",
                                                             color = "black")  + 
  scale_y_continuous(limits = c(0, 86), expand = c(0, 0), breaks = 25*(0:5)) +
  scale_x_continuous(limits = c(0, 75), expand = c(0, 0)) +
  theme_dviz() +
  background_grid(major = "y", minor = "none")

stamp_bad(h3_bad)
```

(ref:titanic-ages-filled) The same histogram of Figure \@ref(fig:titanic-ages-lines), now drawn with filled bars. The shape of the age distribution is much more easily discernible in this variation of the figure.

```{r titanic-ages-filled, message=FALSE, warning=FALSE, fig.cap='(ref:titanic-ages-filled)'}
h3_good <- ggplot(age_hist_3, aes(x = age, y = count)) + geom_col(width = 2.7, fill = "#56B4E9")  + 
  scale_y_continuous(limits = c(0, 86), expand = c(0, 0), breaks = 25*(0:5)) +
  scale_x_continuous(limits = c(0, 75), expand = c(0, 0)) +
  theme_dviz() +
  background_grid(major = "y", minor = "none")

stamp_good(h3_good)
```

Next, let's take a look at an old-school density plot. I'm showing density estimates for the sepal-length distributions of three species of iris, drawn entirely in black-and-white as a line drawing (Figure \@ref(fig:iris-densities-lines)). The distributions are shown just by their outlines, and because the figure is in black-and-white, we're using different line styles to distinguish them. This figure has multiple problems. Most importantly, the dashed line styles do not provide a clean boundary that separates the area under the curve from the area above it. While our visual system is quite good at connecting the individual line elements into a continuous line, these dashed lines nevertheless look porous and do not serve as a strong boundary of the enclose area. Second, because the lines intersect and the areas they enclose are not shaded, we can perceive six different distinct shapes and we need to expend some additional mental energy to merge the correct shapes together. This effect would have been even stronger had I used solid rather than dashed lines for all three distributions.

(ref:iris-densities-lines) Density estimates of the sepal lengths of three different iris species. The broken line styles used for versicolor and virginica detract from the perception that the areas under the curves are distinct from the areas above them.

```{r iris-densities-lines, message=FALSE, warning=FALSE, fig.cap='(ref:iris-densities-lines)'}
# compute densities for sepal lengths
iris_dens <- group_by(iris, Species) %>%
  do(ggplot2:::compute_density(.$Sepal.Length, NULL)) %>%
  rename(Sepal.Length = x)

# get the maximum values
iris_max <- filter(iris_dens, density == max(density)) %>%
  ungroup() %>%
  mutate(hjust = c(0, 0.4, 0),
         vjust = c(1, 0, 1),
         nudge_x = c(0.11, 0, 0.2),
         nudge_y = c(-0.02, 0.02, -0.02) 
        )

iris_lines <- ggplot(iris_dens, aes(x = Sepal.Length, y = density, linetype = Species)) + 
  geom_density_line(stat = "identity", alpha = 0., size = 0.75) +
  geom_text(data = iris_max, aes(label = Species, hjust = hjust, vjust = vjust,
                                 x = Sepal.Length + nudge_x, 
                                 y = density + nudge_y), size = 12/.pt) +
  scale_linetype_manual(values = c(1, 3, 4),
                    breaks = c("virginica", "versicolor", "setosa"),
                    guide = "none") +
  scale_x_continuous(expand = c(0, 0), name = "sepal length") +
  scale_y_continuous(limits = c(0, 1.5), expand = c(0, 0)) +
  theme_dviz()

stamp_bad(iris_lines)
```


*paragraph on the colored version of the iris figure.*

(ref:iris-densities-colored-lines) Density estimates of the sepal lengths of three different iris species. By using solid, colored lines we have solved the probme of Figure \@ref(fig:iris-densities-lines) that the areas below and above the lines seem to be connected. However, we still don't have a strong sense of the size of the area under each curve. Also, the colored labels are hard to read.

```{r iris-densities-colored-lines, message=FALSE, warning=FALSE, fig.cap='(ref:iris-densities-colored-lines)'}
iris_colored_lines <- ggplot(iris_dens, aes(x = Sepal.Length, y = density, color = Species)) + 
  geom_density_line(stat = "identity", alpha = 0., size = 1) +
  geom_text(data = iris_max, aes(label = Species, hjust = hjust, vjust = vjust,
                                 x = Sepal.Length + nudge_x, 
                                 y = density + nudge_y), size = 12/.pt) +
  scale_color_manual(values = c("#56B4E9", "#E69F00", "#009E73"),
                    breaks = c("virginica", "versicolor", "setosa"),
                    guide = "none") +
  scale_x_continuous(expand = c(0, 0), name = "sepal length") +
  scale_y_continuous(limits = c(0, 1.5), expand = c(0, 0)) +
  theme_dviz()

stamp_ugly(iris_colored_lines)
```


(ref:iris-densities-filled) Density estimates of the sepal lengths of three different iris species.

```{r iris-densities-filled, message=FALSE, warning=FALSE, fig.cap='(ref:iris-densities-filled)'}
iris_filled <- ggplot(iris_dens, aes(x = Sepal.Length, y = density, fill = Species)) + 
  geom_density_line(stat = "identity", alpha = 0.7) +
  geom_text(data = iris_max, aes(label = Species, hjust = hjust, vjust = vjust,
                                 x = Sepal.Length + nudge_x, 
                                 y = density + nudge_y), size = 12/.pt) +
  scale_fill_manual(values = c("#56B4E9", "#E69F00", "#009E73"),
                    breaks = c("virginica", "versicolor", "setosa"),
                    guide = "none") +
  scale_x_continuous(expand = c(0, 0), name = "sepal length") +
  scale_y_continuous(limits = c(0, 1.5), expand = c(0, 0)) +
  theme_dviz()
  
stamp_good(iris_filled)
```

(ref:mpg-linespoints) Fuel economy versus engine displacement, for cars with front-wheel drive (FWD), rear-wheel drive (RWD), and all-wheel drive (4WD). The different point styles, all black-and-white line-drawn symbols, create substantial visual noise and make it difficult to read the figure.

```{r mpg-linespoints, fig.width=5, fig.asp=.7416, fig.cap='(ref:mpg-linespoints)'}
mpg_linespoints <- ggplot(mpg, aes(y=cty, x=displ, shape=drv)) +
  geom_point(size = 2) + 
  ylab("fuel economy (mpg)") +
  xlab("displacement (l)") +
  scale_shape_manual(values=c(4, 1, 2), 
                     name="drive train",
                     breaks=c("f", "r", "4"),
                     labels=c("FWD", "RWD", "4WD")) +
  theme(legend.position = c(.7, .8))
stamp_bad(mpg_linespoints)
```


(ref:mpg-filledpoints) Fuel economy versus engine displacement. By using both different colors and different solid shapes for the different drive-train variants, this figure clearly separates the drive-train variants while remaining reproducible in gray scale if needed.

```{r mpg-filledpoints, fig.width=5, fig.asp=.7416, fig.cap='(ref:mpg-filledpoints)'}
mpg_filledpoints <- ggplot(mpg, aes(y=cty, x=displ, color=drv, shape=drv)) +
  geom_point(size = 2.5, alpha = 0.8) + 
  ylab("fuel economy (mpg)") +
  xlab("displacement (l)") +
  scale_color_manual(values=c("#000000", "#E69F00", "#56B4E9"), 
                     name="drive train",
                     breaks=c("f", "r", "4"),
                     labels=c("FWD", "RWD", "4WD")) +
  scale_shape_manual(values=c(18, 16, 17), 
                     name="drive train",
                     breaks=c("f", "r", "4"),
                     labels=c("FWD", "RWD", "4WD")) +
  theme(legend.position = c(.7, .8))

stamp_good(mpg_filledpoints)
```


(ref:lincoln-weather-box-empty) Distributions of daily mean temperatures in Lincoln, Nebraska, in 2016. 

```{r lincoln-weather-box-empty, fig.cap='(ref:lincoln-weather-box-empty)'}
lincoln_weather %>% mutate(month_short = fct_recode(Month,
                                                    Jan = "January",
                                                    Feb = "February",
                                                    Mar = "March",
                                                    Apr = "April",
                                                    May = "May",
                                                    Jun = "June",
                                                    Jul = "July",
                                                    Aug = "August",
                                                    Sep = "September",
                                                    Oct = "October",
                                                    Nov = "November",
                                                    Dec = "December")) %>%
  mutate(month_short = fct_rev(month_short)) -> lincoln_df

lincoln_box_empty <- ggplot(lincoln_df, aes(x = month_short, y = `Mean Temperature [F]`)) +
  geom_boxplot() + xlab("Month")

lincoln_box_empty
```


(ref:lincoln-weather-box-filled) Distributions of daily mean temperatures in Lincoln, Nebraska, in 2016. By giving the boxes a light gray fill, we can make them stand out better against the background.

```{r lincoln-weather-box-filled, fig.cap='(ref:lincoln-weather-box-filled)'}
lincoln_box_filled <- ggplot(lincoln_df, aes(x = month_short, y = `Mean Temperature [F]`)) +
  geom_boxplot(fill = 'grey90') + xlab("Month")

lincoln_box_filled
```
