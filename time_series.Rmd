```{r echo = FALSE, message = FALSE, warning = FALSE}
# run setup script
source("_common.R")

library(ggridges)
library(lubridate)
```

# Visualizing time series and other functions of an independent variable {#time-series}

(ref:biorxiv-dots) Monthly submissions to the preprint server bioRxiv, from its inception in November 2014 until April 2018. Each dot represents the number of submissions in one month. There has been a steady increase in submission volume throughout the entire 4.5-year period. Data source: Jordan Anaya, http://www.prepubmed.org/

```{r biorxiv-dots, fig.cap = '(ref:biorxiv-dots)'}
preprint_growth %>% filter(archive == "bioRxiv") %>%
  filter(count > 0) -> biorxiv_growth

ggplot(biorxiv_growth, aes(date, count)) + geom_point(color = "#0072B2") +
  scale_y_continuous(limits = c(0, 1600), expand = c(0, 0),
                name = "preprints / month") + 
  scale_x_date(name = NULL) +
  theme_dviz_open() +
  theme(plot.margin = margin(7, 7, 3, 0))
```

(ref:biorxiv-line) Monthly submissions to the preprint server bioRxiv, shown as a line graph. **comment on effect of line.** Data source: Jordan Anaya, http://www.prepubmed.org/

```{r biorxiv-line, fig.cap = '(ref:biorxiv-line)'}
ggplot(biorxiv_growth, aes(date, count)) + geom_line(color = "#0072B2", size = .75) +
  scale_y_continuous(limits = c(0, 1600), expand = c(0, 0),
                name = "preprints / month") + 
  scale_x_date(name = NULL) +
  theme_dviz_open() +
  theme(plot.margin = margin(7, 7, 3, 0))
```

(ref:biorxiv-line-area) Monthly submissions to the preprint server bioRxiv, shown as a line graph with filled area underneath. **comment on effect of filled area.** Data source: Jordan Anaya, http://www.prepubmed.org/

```{r biorxiv-line-area, fig.cap = '(ref:biorxiv-line-area)'}
ggplot(biorxiv_growth, aes(date, height = count, y = 0)) + 
  geom_ridgeline(color = "#0072B2", fill = "#0072B240", size = .75) +
  scale_y_continuous(limits = c(0, 1600), expand = c(0, 0),
                name = "preprints / month") + 
  scale_x_date(name = NULL) +
  theme_dviz_open() +
  theme(plot.margin = margin(7, 7, 3, 0))
```

(ref:biorxiv-logscale) Monthly submissions to the preprint server bioRxiv. **comment on the log scale.** Data source: Jordan Anaya, http://www.prepubmed.org/

```{r biorxiv-logscale, fig.cap = '(ref:biorxiv-logscale)'}
ggplot(biorxiv_growth, aes(date, count)) + 
  geom_line(color = "#0072B2", size = .75) +
  scale_y_log10(limits = c(30, 1600),
                breaks = c(10*(3:9), 100*(1:9), 1000*(1:2)),
                labels = c("", "", "50", "", "", "", "",
                           "100", "", "", "", "500", "", "", "", "",
                           "1000", ""), expand = c(0, 0),
                name = "preprints / month") + 
  scale_x_date(name = NULL) +
  theme_dviz_open() +
  theme(plot.margin = margin(7, 7, 3, 0))
```

While individual dots are fine for a single time course, they don't work well when there are multiple ones.

(ref:bio-preprints-points) **figure caption.** Data source: Jordan Anaya, http://www.prepubmed.org/

```{r bio-preprints-points, fig.cap = '(ref:bio-preprints-points)'}
preprint_growth %>% filter(archive %in% c("bioRxiv", "arXiv q-bio", "PeerJ Preprints")) %>%
  filter(count > 0) %>%
  mutate(archive = factor(archive, levels = c("bioRxiv", "arXiv q-bio", "PeerJ Preprints")))-> preprints

p <- ggplot(preprints, aes(date, count, color = archive, fill = archive, shape = archive)) + 
  geom_point(color = "white", size = 2) +
  scale_shape_manual(values = c(21, 22, 23),
                     name = NULL) + 
  scale_y_continuous(limits = c(0, 600), expand = c(0, 0),
                name = "preprints / month") + 
  scale_x_date(name = NULL,
               limits = c(min(biorxiv_growth$date), ymd("2017-01-01"))) +
  scale_color_manual(values = c("#0072b2", "#D55E00", "#009e73"),
                     name = NULL) +
  scale_fill_manual(values = c("#0072b2", "#D55E00", "#009e73"),
                     name = NULL) +
  theme_dviz_open() +
  theme(legend.title.align = 0.5,
        legend.position = c(0.1, .9),
        legend.just = c(0, 1),
        plot.margin = margin(14, 7, 3, 0))

stamp_bad(p)
```

(ref:bio-preprints-lines) **figure caption.** Data source: Jordan Anaya, http://www.prepubmed.org/

```{r bio-preprints-lines, fig.cap = '(ref:bio-preprints-lines)'}
p <- ggplot(preprints, aes(date, count, color = archive, fill = archive, shape = archive)) + 
  geom_line() + geom_point(color = "white", size = 2) +
  scale_shape_manual(values = c(21, 22, 23),
                     name = NULL) + 
  scale_y_continuous(limits = c(0, 600), expand = c(0, 0),
                name = "preprints / month") + 
  scale_x_date(name = NULL,
               limits = c(min(biorxiv_growth$date), ymd("2017-01-01"))) +
  scale_color_manual(values = c("#0072b2", "#D55E00", "#009e73"),
                     name = NULL) +
  scale_fill_manual(values = c("#0072b2", "#D55E00", "#009e73"),
                     name = NULL) +
  theme_dviz_open() +
  theme(legend.title.align = 0.5,
        legend.position = c(0.1, .9),
        legend.just = c(0, 1),
        plot.margin = margin(14, 7, 3, 0))

p
```

(ref:bio-preprints-direct-label) **figure caption.** Data source: Jordan Anaya, http://www.prepubmed.org/

```{r bio-preprints-direct-label, fig.cap = '(ref:bio-preprints-direct-label)'}
preprints_final <- filter(preprints, date == ymd("2017-01-01"))

p <- ggplot(preprints, aes(date, count, color = archive)) + 
  geom_line(size = .75) +
  scale_shape_manual(values = c(21, 22, 23),
                     name = NULL) + 
  scale_y_continuous(limits = c(0, 600), expand = c(0, 0),
                name = "preprints / month",
                sec.axis = dup_axis(breaks = preprints_final$count,
                                    labels = c("arXiv\nq-bio", "PeerJ\nPreprints", "bioRxiv"),
                                    name = NULL)) + 
  scale_x_date(name = NULL,
               limits = c(min(biorxiv_growth$date), ymd("2017-01-01")),
               expand = expand_scale(mult = c(0.05, 0))) +
  scale_color_manual(values = c("#0072b2", "#D55E00", "#009e73")) +
  theme_dviz_open() +
  theme(legend.position = "none") +
  theme(axis.line.y.right = element_blank(),
        axis.ticks.y.right = element_blank(),
        axis.text.y.right = element_text(margin = margin(0, 0, 0, 0)),
        plot.margin = margin(14, 7, 3, 0))

p
```

Other types of time-series visualizations:

- x-y plane with lines connecting subsequent time points, see e.g. http://lenkiefer.com/2017/08/07/house-price-trends/

(ref:house-price-path) **figure caption.** Original figure concept: Len Kiefer

```{r house-price-path, fig.width = 5, fig.asp = 3/4, fig.cap = '(ref:house-price-path)'}
ggplot(filter(house_prices, state == "California", year(date) > 2000),
        aes(unemploy_perc, house_price_perc)) + 
  geom_path() +
  theme_dviz_grid()
```


Also discuss that does-response cases are similar to time series. For that setting, maybe use `oats` from MASS?

