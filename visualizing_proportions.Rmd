```{r echo = FALSE, message = FALSE}
# run setup script
source("_common.R")
library(dplyr)
library(colorblindr)
```


# Visualizing proportions

```{r}
# Example recreated after:
# https://en.wikipedia.org/wiki/File:Piecharts.svg
# Original example by: https://commons.wikimedia.org/wiki/User:Schutz

five_cases <- data.frame(percent = c(17, 18, 20, 22, 23, 20, 20, 19, 21, 20, 23, 22, 20, 18, 17),
                         company = rep(LETTERS[1:5], 3),
                         year = rep(c("2015", "2016", "2017"), each = 5))

five_cases <- group_by(five_cases, year) %>%
    mutate(fraction = percent / sum(percent),
           label_pos = 100*(1 - cumsum(fraction) + fraction / 2)) 

```

```{r five-cases-side-by-side}
ggplot(five_cases, aes(x = company, y = percent, fill = company)) + 
  geom_col() + 
  facet_wrap(~year) +
  scale_y_continuous(expand = c(0, 0)) +
  scale_fill_OkabeIto()
```

```{r five-cases-stacked-bars}
ggplot(five_cases, aes(x = year, y = percent, fill = company)) + 
  geom_col(position = "stack") + 
  scale_y_continuous(expand = c(0, 0)) +
  scale_fill_OkabeIto(order = c(1:3, 5, 4))
```

```{r five-cases-pies, fig.width = 8.5}
pies <- ggplot(five_cases, aes(x = 1, y = percent, fill = company)) + 
  geom_col(position = "stack") + 
  geom_text(aes(x = 1.6, y = label_pos, label = company)) +
  facet_wrap(~year) +
  coord_polar(theta = "y") +
  scale_y_continuous(breaks = NULL, name = "") +
  scale_x_continuous(breaks = NULL, name = "") +
  scale_fill_OkabeIto() + 
  theme(axis.line.x = element_blank(),
        legend.position = "none",
        strip.background = element_blank())

pies
```

Table: (\#tab:pros-cons-pie-bar) Pros and cons of common apporaches to visualizing proportions: pie charts, stacked bars, and side-by-side bars. 

----------------------------------------------------------------------------------------
                                    Pie chart         Stacked bars      Side-by-side bars
-----------------------------  ------------------- ------------------- -------------------
Clearly visualizes the data             ✔                 ✔                   ✖
as proportions of a whole

Allows easy visual comparison           ✖                 ✖                   ✔ 
of the relative proportions 

Colored areas are proportional            ✖                 ✔                   ✔ 
to the visualized data values

Visually emphasizes simple              ✔                 ✖                   ✖
fractions, such as 1/2, 1/3,
1/4

Looks visually appealing                ✔                 ✖                   ✔
even for very small datasets

Works well when the whole is            ✖                 ✖                   ✔ 
broken into many pieces

Works well for the                      ✖                 ✔                   ✖
visualization of many sets of
proportions or time series
of proportions
----------------------------------------------------------------------------------------

